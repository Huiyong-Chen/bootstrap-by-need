# 006 - 成长的烦恼与工具链的觉醒

## 1. 清晰度的代价 (The Cost of Clarity)
Stage 5 的组件化重构是成功的，代码变得井井有条。但物理法则很快找上门来：浏览器为了加载首页，不得不发起几十个 HTTP 请求。
**Network 面板里的瀑布流（Waterfall）在嘲笑我**：
“你看，你为了自己开发爽（拆分文件），让用户等着你（请求阻塞）。”
我意识到，**开发时的离散（便于维护）**和**运行时的聚合（便于传输）**是天然矛盾的。
必须引入构建工具（Vite）来调和这个矛盾。

## 2. 依赖的顿悟 (The Dependency Epiphany)
引入构建工具后的第一次打包，`index.js` 竟然有一万多行。
排查发现，是因为我之前为了避开 npm，手动下载了一个巨大的 `docx.js` 放在源码里。它像块死肉一样混在我的代码中。
这一刻我明白了：**当依赖复杂到一定程度，手动管理就是一种债务。**
我删除了本地文件，改用 `npm install docx`。虽然体积依然大，但源码干净了，版本可控了。

## 3. 自动化的开端 (Automation First)
为了配合严格的 ESM 规范，我决定将文件后缀迁移到 `.mts`。
面对几十个文件，我本能地抗拒手动修改。
于是，我写了 `scripts/ts-to-mts.mts`。为了写这个脚本，我又引入了 `tsx` 和 `minimatch`。
**这标志着项目进入了一个新阶段：**
我不再只是写业务代码，我开始编写“维护代码的代码”。工程化基建（Infrastructure）由此诞生。

## 4. 配置的对齐 (Alignment)
最后是琐碎但致命的细节：VS Code 里的红色波浪线、Vite 的解析规则、TypeScript 的类型检查。
别名 `@` 很好用，但它让 CSS 跳转失效了；`.mts` 很严谨，但工具链需要显式配置才能识别。
架构师的工作，很多时候就是**在不同的工具配置之间寻找那个交集**，让 IDE、编译器和构建工具达成共识。

我们最终选择了“逻辑用别名，资源用相对路径”的实用主义策略。